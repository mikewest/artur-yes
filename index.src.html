<pre class="metadata">
Title: Anti-XSS Response-Time Uniqueness Requirement
Status: DREAM
Shortname: artur-yes
Level: None
Editor: Mike West
Abstract: If Artur is yes, then nonce is go!
Indent: 2
Version History: https://github.com/mikewest/artur-yes/commits/master/index.src.html
!Participate: <a href="https://github.com/mikewest/artur-yes/issues/new">File an issue</a> (<a href="https://github.com/mikewest/artur-yes/issues">open issues</a>)
Markup Shorthands: css off, markdown on
</pre>
<pre class="biblio">
{
  "HTTP-JFV": {
    "authors": [ "Julian Reschke" ],
    "href": "https://greenbytes.de/tech/webdav/draft-reschke-http-jfv-02.html",
    "title": "A JSON Encoding for HTTP Header Field Values"
  },
  "ORIGIN-POLICY": {
    "authors": [ "Mike West" ],
    "href": "https://mikewest.github.io/origin-policy/",
    "title": "Origin Policy"
  }
}
</pre>

Introduction {#intro}
============

Content Security Policy [[CSP]] is difficult to use in some cases, as the syntax is complicated,
the overriding rules are confused, and the feature itself serves several different purposes. This
document proposes a subset of CSP focused strictly on XSS protection, inspired in large part by
Artur, et al.'s work on `'strict-dynamic'`. The goal is to provide the same guarantees as a
verbose and complicated CSP, in a pithy and comprehensible package.

Framework {#framework}
=========

The `Artur` HTTP Response Header {#header}
--------------------------------

The <dfn export http-header>`Artur`</dfn> HTTP response header field is the delivery mechanism for
the XSS protections this document offers. The header's value is represented by the following ABNF
[[!RFC5234]]:

<pre>
  Artur = json-field-value
</pre>

<div class="example">
  <pre>
    <a http-header>Artur</a>: { "nonce": "abcdefg", "report": "group1" }
  </pre>

  This header will have the same effect as the `Content-Security-Policy` header:

  <pre>
    <a http-header>Content-Security-Policy</a>: script-src 'strict-dynamic' 'nonce-abcdegf';
                             object-src 'none';
                             report-to group1;
  </pre>
</div>

A server MAY send different `Artur` header field values with different representations of the
same resource.

The headerâ€™s value is interpreted as an array of JSON objects, as described in Section 4 of [[!HTTP-JFV]].

Algorithms {#algorithms}
----------

When executing [[csp3#set-response-csp-list]], run the following steps before the current step 4:

4.  Let |list| be the result of executing the algorithm defined in Section 4 of [[HTTP-JFV]] on the
    value of |response|'s <a http-header>`Artur`</a> header.
    
    If that algorithm does not result in error, then, for each |item| in |list|:

    1.  If |item| does not have a `nonce` member, or |item|'s `nonce` member's value does not match
        the <a grammar>base64-value</a> grammar, skip the remaining substeps, and move to the
        next |item|.

    2.  Let |policy| be a new <a for="/">policy</a> with an empty <a>directive set</a>, and a
        disposition of "`enforce`".

    3.  Add a <a>directive</a> to |policy| whose <a for="directive">name</a> is "`script-src`",
        and whose <a for="directive">value</a> is the result of replacing "`%s`" in the string
        "'nonce-%s' 'strict-dynamic'" with the value of |item|'s `nonce` member.

    4.  Add a <a>directive</a> to |policy| whose <a for="directive">name</a> is "`object-src`",
        and whose <a for="directive">value</a> is "`'none'`".

    5.  If |item| has a `report` member whose value matches the `token` grammar [[RFC7230]]:

        1.  Add a <a>directive</a> to |policy| whose <a for="directive">name</a> is "`report-to`",
            and whose <a for="directive">value</a> is the value of |item|'s `report` member.

    6.  Append |policy| to |policies|.

Acknowledgements {#acks}
================

We like Artur.
