<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>XSS Protection</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em 0;
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: normal;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed 1.0.0" name="generator">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "¶"; }
            .heading > a.self-link::before { content: "§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figcaption {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure) " ";
            }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "‘";
            }
            .css::after, .property::after, .descriptor::after {
                content: "’";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "‘";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "’";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">XSS Protection</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">A Collection of Interesting Ideas, <time class="dt-updated" datetime="2016-10-07">7 October 2016</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Version History:
     <dd><a href="https://github.com/mikewest/artur-yes/commits/master/index.src.html">https://github.com/mikewest/artur-yes/commits/master/index.src.html</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/mikewest/artur-yes/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><span class="p-name fn">Mike West</span>
     <dt>Participate:
     <dd><span><a href="https://github.com/mikewest/artur-yes/issues/new">File an issue</a> (<a href="https://github.com/mikewest/artur-yes/issues">open issues</a>)</span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" src="https://licensebuttons.net/p/zero/1.0/80x15.png"></a> To the extent possible under law, the editors have waived all copyright
and related or neighboring rights to this work.
In addition, as of 7 October 2016,
the editors have made this specification available under the <a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from another specification document.  If so, those parts are instead covered by the license of that specification document. </p>
   <hr title="Separator for header">
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>This document describes a mechanism which allows developers to restrict the ways in which their pages can execute script, with the goal of mitigating cross-site scripting vulnerabilities.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#framework"><span class="secno">2</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#policy"><span class="secno">2.1</span> <span class="content">Policy</span></a>
      <li>
       <a href="#algorithms"><span class="secno">2.2</span> <span class="content">Algorithms</span></a>
       <ol class="toc">
        <li><a href="#policy-for-response"><span class="secno">2.2.1</span> <span class="content"> Obtain a set of XSS protection policies for <var>response</var>. </span></a>
       </ol>
     </ol>
    <li>
     <a href="#header"><span class="secno">3</span> <span class="content">The <code>XSS-Protection</code> HTTP Response Header</span></a>
     <ol class="toc">
      <li><a href="#hash-member"><span class="secno">3.1</span> <span class="content">The <code>hash</code> member</span></a>
      <li><a href="#nonce-member"><span class="secno">3.2</span> <span class="content">The <code>nonce</code> member</span></a>
      <li><a href="#reflection-member"><span class="secno">3.3</span> <span class="content">The <code>reflection</code> member</span></a>
      <li><a href="#report-member"><span class="secno">3.4</span> <span class="content">The <code>report</code> member</span></a>
     </ol>
    <li>
     <a href="#integrations"><span class="secno">4</span> <span class="content">Integrations</span></a>
     <ol class="toc">
      <li>
       <a href="#monkey-patching-fetch"><span class="secno">4.1</span> <span class="content">Integration with Fetch</span></a>
       <ol class="toc">
        <li><a href="#set-response-csp-list"><span class="secno">4.1.1</span> <span class="content"> Populate <var>response</var>’s CSP list from its XSS protection policy. </span></a>
       </ol>
      <li>
       <a href="#monkey-patching-html"><span class="secno">4.2</span> <span class="content">Integration with HTML</span></a>
       <ol class="toc">
        <li><a href="#initialize-document-xss"><span class="secno">4.2.1</span> <span class="content"> Initialize a <code>Document</code>'s reflected XSS policy. </span></a>
        <li><a href="#parse-x-xss-protection"><span class="secno">4.2.2</span> <span class="content"> Parse <var>response</var>’s <code>X-XSS-Protection</code> header value. </span></a>
       </ol>
     </ol>
    <li>
     <a href="#implementation"><span class="secno">5</span> <span class="content">Implementation Considerations</span></a>
     <ol class="toc">
      <li><a href="#error-messages"><span class="secno">5.1</span> <span class="content">Error Messages</span></a>
     </ol>
    <li><a href="#acks"><span class="secno">6</span> <span class="content">Acknowledgements</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>Cross-site scripting is a problem for developers. Despite the existence of context-aware escaping
mechanisms in templating systems, content injection continues to be one of of the most common
attack vectors.</p>
   <p>Content Security Policy <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> aims to reduce the risk of these attacks, and is widely supported
by browsers. It has proven to be difficult to deploy, however, as the syntax is complicated, the
overriding rules are confused, and the feature itself serves several different purposes. Recent
research has shown flaws in real-world deployments result in policies that are ineffective at
directly preventing cross-site scripting in the overwhelming majority of cases <a data-link-type="biblio" href="#biblio-csp-is-dead">[CSP-IS-DEAD]</a>.
That research, and related discussions, has lead to new approaches within CSP (like those
described in <a href="https://w3c.github.io/webappsec-csp/#strict-dynamic-usage">Content Security Policy Level 3 §strict-dynamic-usage</a>) which seem promising, but the syntax ends up being
somewhat verbose and the behavior confusing due to backwards compatibility concerns.</p>
   <p>This document proposes a policy language focused strictly on XSS protection, pulling in a subset
of CSP’s functionality, along with existing functionality such as that supported by the <code>X-XSS-Protection</code> HTTP response header. The goal is to provide the same XSS mitigation guarantees
as a verbose and complicated CSP, in a pithy and comprehensible package.</p>
   <div class="example" id="example-bc4325b3">
    <a class="self-link" href="#example-bc4325b3"></a> MegaCorp, Inc. wishes to defend against cross-site scripting. It can do so by generating a unique
  string for each page load, and including that string both in an <a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-1"><code>XSS-Protection</code></a> header and in the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> element’s <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/scripting.html#attr-script-nonce">nonce</a></code> attribute, as follows: 
<pre class="highlight"><a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-2">XSS-Protection</a>: { <span class="s">"</span><a data-link-type="dfn" dictionary-member="" href="#xssprotectionpolicy-nonce" id="ref-for-xssprotectionpolicy-nonce-1"><span class="s">nonce</span></a><span class="s">"</span>: <span class="s">"</span><strong><span class="s">abcdefg</span></strong><span class="s">"</span> }
</pre>
<pre class="highlight"><span class="c">&lt;!--</span><span class="c"> This script will execute. </span><span class="c">--></span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"script.js"</span> <span class="na">nonce=</span><span class="s">"</span><strong><span class="s">abcdefg</span></strong><span class="s">"</span><span class="nt">></span><span class="nt">&lt;/script></span>

<span class="c">&lt;!--</span><span class="c"> This script won’t (no nonce). </span><span class="c">--></span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"script.js"</span><span class="nt">></span><span class="nt">&lt;/script></span>
</pre>
    <p class="note" role="note">Note: This will also have the happy side-effect of enabling the user agent’s built-in XSS
  protections in "blocking" mode rather than the user agent’s default "filtering" mode. Hooray!</p>
   </div>
   <h2 class="heading settled" data-level="2" id="framework"><span class="secno">2. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
   <p>This specification uses terminology from <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a> and <a data-link-type="biblio" href="#biblio-http-jfv">[HTTP-JFV]</a> to define its syntax
expectations, and relies heavily on <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> (which itself relies on <a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a> and <a data-link-type="biblio" href="#biblio-html">[HTML]</a>) for
enforcement.</p>
   <h3 class="heading settled" data-level="2.1" id="policy"><span class="secno">2.1. </span><span class="content">Policy</span><a class="self-link" href="#policy"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="xss-protection-policy">XSS protection policy</dfn> defines a set of behaviors which are to be applied to
a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/browsers.html#window">Window</a></code> or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">WorkerGlobalScope</a></code>.</p>
   <p>Each policy has a <dfn class="dfn-paneled" data-dfn-for="XSS protection policy" data-dfn-type="dfn" data-noexport="" id="xss-protection-policy-nonce">nonce</dfn> which is a string. Its value is the
empty string unless otherwise specified.</p>
   <p>Each policy has a <dfn class="dfn-paneled" data-dfn-for="XSS protection policy" data-dfn-type="dfn" data-noexport="" id="xss-protection-policy-hash-set">hash set</dfn> which is a set of strings. Its
value is the empty set unless otherwise specified.</p>
   <p>Each policy has a <dfn class="dfn-paneled" data-dfn-for="XSS protection policy" data-dfn-type="dfn" data-noexport="" id="xss-protection-policy-reporting-group">reporting group</dfn> which is a string. Its
value is the string "<code>default</code>" unless otherwise specified.</p>
   <p>Each policy has a <dfn class="dfn-paneled" data-dfn-for="XSS protection policy" data-dfn-type="dfn" data-noexport="" id="xss-protection-policy-reflection-policy">reflection policy</dfn> which is one of
"<code>ignore</code>", "<code>filter</code>", or "<code>block</code>". Its value is "<code>block</code>" unless otherwise specified.</p>
   <h3 class="heading settled" data-level="2.2" id="algorithms"><span class="secno">2.2. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h3>
   <h4 class="heading settled algorithm" data-algorithm="Obtain a set of XSS protection policies for response." data-level="2.2.1" id="policy-for-response"><span class="secno">2.2.1. </span><span class="content"> Obtain a set of XSS protection policies for <var>response</var>. </span><a class="self-link" href="#policy-for-response"></a></h4>
   <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>), this algorithm returns a sequence of <a data-link-type="dfn" href="#xss-protection-policy" id="ref-for-xss-protection-policy-1">XSS protection
policy</a> objects. If no valid policy is found for <var>response</var>, the returned sequence will be
empty.</p>
   <ol>
    <li data-md="">
     <p>Let <var>policies</var> be an empty sequence.</p>
    <li data-md="">
     <p>Let <var>value</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-parse">parsing</a> "<a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-3"><code>XSS-Protection</code></a>" in <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>.</p>
    <li data-md="">
     <p>If <var>value</var> is <code>null</code>, return <var>policies</var>.</p>
    <li data-md="">
     <p>Let <var>list</var> be the result of executing the algorithm defined in Section 4 of <a data-link-type="biblio" href="#biblio-http-jfv">[HTTP-JFV]</a> on <var>value</var>. If that algorithm results in an error, return <var>policies</var>.</p>
    <li data-md="">
     <p>For each <var>item</var> in <var>list</var>:</p>
     <ol>
      <li data-md="">
       <p>Let <var>policy</var> be a new <a data-link-type="dfn" href="#xss-protection-policy" id="ref-for-xss-protection-policy-2">XSS protection policy</a>.</p>
      <li data-md="">
       <p>If <var>item</var> has a <code class="idl"><a data-link-type="idl" href="#dom-xssprotectionpolicy-hash" id="ref-for-dom-xssprotectionpolicy-hash-1">hash</a></code> member whose value (<var>value</var>) is a <code>sequence&lt;DOMString></code>, then for each <var>digest</var> in <var>value</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>digest</var> matches the ABNF grammar <code><a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-algorithm">hash-algorithm</a>-<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source">hash-source</a></code> (as defined in <a data-link-type="biblio" href="#biblio-csp">[CSP]</a>), then add <var>digest</var> to <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-hash-set" id="ref-for-xss-protection-policy-hash-set-1">hash set</a>.</p>
       </ol>
      <li data-md="">
       <p>If <var>item</var> has a <code class="idl"><a data-link-type="idl" href="#dom-xssprotectionpolicy-nonce" id="ref-for-dom-xssprotectionpolicy-nonce-1">nonce</a></code> member whose value (<var>value</var>) is a <code>DOMString</code> that matches the ABNF grammar <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-base64-value"><code>base64-value</code></a> (as defined in <a data-link-type="biblio" href="#biblio-csp">[CSP]</a>), then set <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-nonce" id="ref-for-xss-protection-policy-nonce-1">nonce</a> to <var>value</var>.</p>
      <li data-md="">
       <p>If <var>item</var> has a <code class="idl"><a data-link-type="idl" href="#dom-xssprotectionpolicy-reflection" id="ref-for-dom-xssprotectionpolicy-reflection-1">reflection</a></code> member whose value (<var>value</var>) is a valid <code class="idl"><a data-link-type="idl" href="#enumdef-reflectedxsspolicy" id="ref-for-enumdef-reflectedxsspolicy-1">ReflectedXSSPolicy</a></code>, then set <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-reflection-policy" id="ref-for-xss-protection-policy-reflection-policy-1">reflection
  policy</a> to <var>value</var>.</p>
      <li data-md="">
       <p>If <var>item</var> has a <code class="idl"><a data-link-type="idl" href="#dom-xssprotectionpolicy-report" id="ref-for-dom-xssprotectionpolicy-report-1">report</a></code> member whose value (<var>value</var>) matches the <a data-link-type="grammar" href="https://tools.ietf.org/html/rfc7230#section-3.2.6"><code>token</code></a> grammar (as defined in <a data-link-type="biblio" href="#biblio-rfc7230">[RFC7230]</a>), then set <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-reporting-group" id="ref-for-xss-protection-policy-reporting-group-1">reporting group</a> to <var>value</var>.</p>
      <li data-md="">
       <p>Append <var>policy</var> to <var>policies</var>.</p>
     </ol>
    <li data-md="">
     <p>Return <var>policies</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="3" id="header"><span class="secno">3. </span><span class="content">The <code>XSS-Protection</code> HTTP Response Header</span><a class="self-link" href="#header"></a></h2>
   <p>The <dfn class="dfn-paneled" data-dfn-type="http-header" data-export="" id="http-headerdef-xss-protection"><code>XSS-Protection</code></dfn> HTTP response header field is the delivery
mechanism for the mitigations this document offers. The header’s value is a <dfn data-dfn-type="dfn" data-lt="serialized XSS protection policy" data-noexport="" id="serialized-xss-protection-policy">serialized XSS
protection policy<a class="self-link" href="#serialized-xss-protection-policy"></a></dfn> represented by the following ABNF <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>:</p>
<pre>XSS-Protection = <a data-link-type="grammar" href="http://httpwg.org/http-extensions/jfv.html#rfc.section.2">json-field-value</a>
</pre>
   <div class="example" id="example-3569342c">
    <a class="self-link" href="#example-3569342c"></a> 
<pre><a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-4">XSS-Protection</a>: { "nonce": "abcdefg", "reflection": "block", "report": "group1" }
</pre>
    <p>This header will have more or less the same effect as delivering the following headers:</p>
<pre><a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">Content-Security-Policy</a>: script-src 'strict-dynamic' 'nonce-abcdegf';
                         object-src 'none';
                         report-to group1;
X-XSS-Protection: 1; mode=block; report=group1;
</pre>
   </div>
   <p>A server MAY send different <code>X-XSS-Protection</code> header field values with different representations
of the same resource.</p>
   <p>The header’s value is interpreted as an array of JSON objects, as described in Section 4 of <a data-link-type="biblio" href="#biblio-http-jfv">[HTTP-JFV]</a>. Detailed parsing instructions are found in <a href="#policy-for-response">§2.2.1 Obtain a set of XSS protection policies for response.</a>, but the syntax
boils down to a representation of the following dictionary type:</p>
<pre class="idl highlight def"><span class="kt">enum</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-reflectedxsspolicy">ReflectedXSSPolicy</dfn> {
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ReflectedXSSPolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;ignore&quot;|ignore" id="dom-reflectedxsspolicy-ignore">"ignore"</dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ReflectedXSSPolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;filter&quot;|filter" id="dom-reflectedxsspolicy-filter">"filter"</dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ReflectedXSSPolicy" data-dfn-type="enum-value" data-export="" data-lt="&quot;block&quot;|block" id="dom-reflectedxsspolicy-block">"block"</dfn>
};

<span class="kt">dictionary</span> <dfn class="nv idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-xssprotectionpolicy">XSSProtectionPolicy<a class="self-link" href="#dictdef-xssprotectionpolicy"></a></dfn> {
  <span class="kt">sequence</span>&lt;<span class="kt">DOMString</span>> <dfn class="nv dfn-paneled idl-code" data-dfn-for="XSSProtectionPolicy" data-dfn-type="dict-member" data-export="" data-type="sequence<DOMString> " id="dom-xssprotectionpolicy-hash">hash</dfn>;
  <span class="kt">DOMString</span> <dfn class="nv dfn-paneled idl-code" data-dfn-for="XSSProtectionPolicy" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-xssprotectionpolicy-nonce">nonce</dfn>;
  <a class="n" data-link-type="idl-name" href="#enumdef-reflectedxsspolicy" id="ref-for-enumdef-reflectedxsspolicy-2">ReflectedXSSPolicy</a> <dfn class="nv dfn-paneled idl-code" data-default="&quot;block&quot;" data-dfn-for="XSSProtectionPolicy" data-dfn-type="dict-member" data-export="" data-type="ReflectedXSSPolicy " id="dom-xssprotectionpolicy-reflection">reflection</dfn> = "block";
  <span class="kt">DOMString</span> <dfn class="nv dfn-paneled idl-code" data-default="&quot;default&quot;" data-dfn-for="XSSProtectionPolicy" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-xssprotectionpolicy-report">report</dfn> = "default";
};
</pre>
   <p>The following subsections define the behavior of each of the known members the header’s value
defines. Future versions of this document may define additional members; user agents MUST ignore
unknown members when parsing the header.</p>
   <h3 class="heading settled" data-level="3.1" id="hash-member"><span class="secno">3.1. </span><span class="content">The <code>hash</code> member</span><a class="self-link" href="#hash-member"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-for="XSSProtectionPolicy" data-dfn-type="dfn" data-noexport="" dictionary-member="" id="xssprotectionpolicy-hash">hash</dfn> member defines a set of digests
which specify specific script content which is allowed to execute on a given page.</p>
   <p>If present, the member’s value MUST be a sequence of <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></code>s, and each MUST adhere to the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source">hash-source</a> grammar specified in <a href="https://w3c.github.io/webappsec-csp/#framework-directive-source-list">Content Security Policy Level 3 §framework-directive-source-list</a>. Any
item in the sequence that does not match that grammer MUST be ignored.</p>
   <div class="example" id="example-f9e5c664">
    <a class="self-link" href="#example-f9e5c664"></a> MegaCorp, Inc. wishes to ensure that injected <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> elements do not execute. They can do so
  by executing a secure hash function (like those specified in <a data-link-type="biblio" href="#biblio-sha2">[SHA2]</a>) on each script they wish to
  execute, and including the resulting list of digests in an <a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-5"><code>XSS-Protection</code></a> header. These digests either match the inline content of a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> element or event handler, or
  match a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> element’s <code><a data-link-type="element-sub" href="https://w3c.github.io/webappsec-subresource-integrity/#dom-htmlscriptelement-integrity">integrity</a></code> attribute: 
<pre><a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-6">XSS-Protection</a>: { "<a data-link-type="dfn" href="#xssprotectionpolicy-hash" id="ref-for-xssprotectionpolicy-hash-1">hash</a>": [ "<strong>sha256-abcd...</strong>", "<strong>sha256-zyx...</strong>" ] }

...

&lt;script src="script.js" integrity="<strong>sha256-abcd...</strong>">&lt;/script>
&lt;script>
  // Content which hashes to <code>abcd...</code> goes here.
&lt;/script>
    
&lt;a onclick="// Content which hashes to <code>zyx...</code> goes here.">Click!&lt;/a>
</pre>
   </div>
   <h3 class="heading settled" data-level="3.2" id="nonce-member"><span class="secno">3.2. </span><span class="content">The <code>nonce</code> member</span><a class="self-link" href="#nonce-member"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-for="XSSProtectionPolicy" data-dfn-type="dfn" data-noexport="" dictionary-member="" id="xssprotectionpolicy-nonce"><code>nonce</code></dfn> member defines a cryptographic
nonce ("number used once") which can be used to ensure that only <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> elements whose <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/scripting.html#attr-script-nonce">nonce</a></code> attributes contain a specific value are allowed to execute script for a given page.</p>
   <p>If present, the member’s value MUST be a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></code>, and MUST adhere to the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-base64-value">base64-value</a> grammar specified in <a href="https://w3c.github.io/webappsec-csp/#framework-directive-source-list">Content Security Policy Level 3 §framework-directive-source-list</a>. If the
member’s value does not match that grammar, the value MUST be ignored.</p>
   <div class="example" id="example-4de9c446">
    <a class="self-link" href="#example-4de9c446"></a> MegaCorp, Inc. wishes to ensure that injected <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> elements do not execute. They can do so
  by generating a unique string for each page load, and including that string both in an <a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-7"><code>XSS-Protection</code></a> header and in the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> element’s <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/scripting.html#attr-script-nonce">nonce</a></code> attribute, as follows: 
<pre><a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-8">XSS-Protection</a>: { "<a data-link-type="dfn" dictionary-member="" href="#xssprotectionpolicy-nonce" id="ref-for-xssprotectionpolicy-nonce-2">nonce</a>": "<strong>abcdefg</strong>" }

...

&lt;script src="script.js" nonce="<strong>abcdefg</strong>">&lt;/script>
</pre>
   </div>
   <h3 class="heading settled" data-level="3.3" id="reflection-member"><span class="secno">3.3. </span><span class="content">The <code>reflection</code> member</span><a class="self-link" href="#reflection-member"></a></h3>
   <p>The <dfn data-dfn-for="XSSProtectionPolicy" data-dfn-type="dfn" data-noexport="" dictionary-member="" id="xssprotectionpolicy-reflection"><code>reflection</code><a class="self-link" href="#xssprotectionpolicy-reflection"></a></dfn> member controls the behavior
of any built-in mechanisms a user agent provides to actively defend against reflected cross-site
scripting.</p>
   <p>The known values for this member are as follows:</p>
   <dl>
    <dt data-md="">
     <p><code class="idl"><a data-link-type="idl" href="#dom-reflectedxsspolicy-ignore" id="ref-for-dom-reflectedxsspolicy-ignore-1">ignore</a></code></p>
    <dd data-md="">
     <p>Disables the user agent’s active defenses against XSS.</p>
    <dt data-md="">
     <p><code class="idl"><a data-link-type="idl" href="#dom-reflectedxsspolicy-filter" id="ref-for-dom-reflectedxsspolicy-filter-1">filter</a></code></p>
    <dd data-md="">
     <p>Enables the user agent’s active defenses against XSS, filtering reflected script from the page.
  This is the default behavior for most user agents that implement such protections.</p>
    <dt data-md="">
     <p><code class="idl"><a data-link-type="idl" href="#dom-reflectedxsspolicy-block" id="ref-for-dom-reflectedxsspolicy-block-1">block</a></code></p>
    <dd data-md="">
     <p>Enables the user agent’s active defenses against XSS, blocking the page entirely if reflected
  script is detected. Generally speaking, this is safer than <code class="idl"><a data-link-type="idl" href="#dom-reflectedxsspolicy-filter" id="ref-for-dom-reflectedxsspolicy-filter-2">filter</a></code>, and
  we use it as the fallback when an <a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-9"><code>XSS-Protection</code></a> header is delivered
  without specifying a behavior.</p>
   </dl>
   <p>User agents MAY choose not to support this attribute if they do not implement such heuristics.</p>
   <div class="example" id="example-0bede70d">
    <a class="self-link" href="#example-0bede70d"></a> MegaCorp, Inc. wishes to ensure that the user agent’s built-in XSS protection mechanisms are
  active, but does not want the browser to simply filter out suspected reflections. They prefer to
  block the page load entirely. They can do so with the following header: 
<pre><a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-10">XSS-Protection</a>: { "<a data-link-type="idl" href="#dom-xssprotectionpolicy-reflection" id="ref-for-dom-xssprotectionpolicy-reflection-2">reflection</a>": "<a data-link-type="idl" href="#dom-reflectedxsspolicy-block" id="ref-for-dom-reflectedxsspolicy-block-2">block</a>" }
</pre>
   </div>
   <h3 class="heading settled" data-level="3.4" id="report-member"><span class="secno">3.4. </span><span class="content">The <code>report</code> member</span><a class="self-link" href="#report-member"></a></h3>
   <p>The <dfn data-dfn-for="XSSProtectionPolicy" data-dfn-type="dfn" data-noexport="" dictionary-member="" id="xssprotectionpolicy-report"><code>report</code><a class="self-link" href="#xssprotectionpolicy-report"></a></dfn> member defines the reporting
group to which violation reports will be sent <a data-link-type="biblio" href="#biblio-reporting">[REPORTING]</a>.</p>
   <p>The member’s value MUST be a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></code>. If an empty string is provided, reporting will be
disabled.</p>
   <p class="note" role="note">Note: Reporting to the group named "<code>default</code>" is enabled unless otherwise specified.</p>
   <div class="example" id="example-1a2b184b">
    <a class="self-link" href="#example-1a2b184b"></a> MegaCorp, Inc. wishes to receive violation reports when script execution is blocked by the XSS
  protection policy it specifies. It can do so by sending a <code class="idl"><a data-link-type="idl" href="#dom-xssprotectionpolicy-report" id="ref-for-dom-xssprotectionpolicy-report-2">report</a></code> member
  along with the policy, and specifying a reporting endpoint, as follows: 
<pre><a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-11">XSS-Protection</a>: { "<a data-link-type="idl" href="#dom-xssprotectionpolicy-nonce" id="ref-for-dom-xssprotectionpolicy-nonce-2">nonce</a>": "abcdefg", "<a data-link-type="idl" href="#dom-xssprotectionpolicy-report" id="ref-for-dom-xssprotectionpolicy-report-3">report</a>": "group1" }
<a data-link-type="http-header" href="https://wicg.github.io/reporting/#report-to">Report-To</a>: { "<a data-link-type="dfn">url</a>": "https://example.com/report", "<a data-link-type="dfn">group</a>": "group1", "<a data-link-type="dfn">max-age</a>": 10886400 }
</pre>
   </div>
   <h2 class="heading settled" data-level="4" id="integrations"><span class="secno">4. </span><span class="content">Integrations</span><a class="self-link" href="#integrations"></a></h2>
   <p>The <a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-12"><code>XSS-Protection</code></a> header is little more than syntactic sugar on top of
existing processing algorithms for <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> and <code>X-XSS-Protection</code>. This section explains the ways
in which the <a data-link-type="dfn" href="#xss-protection-policy" id="ref-for-xss-protection-policy-3">XSS protection policy</a> is enforced for a given context:</p>
   <h3 class="heading settled" data-level="4.1" id="monkey-patching-fetch"><span class="secno">4.1. </span><span class="content">Integration with Fetch</span><a class="self-link" href="#monkey-patching-fetch"></a></h3>
   <ol>
    <li data-md="">
     <p>When executing <a href="https://w3c.github.io/webappsec-csp/#set-response-csp-list">Content Security Policy Level 3 §set-response-csp-list</a> (currently as step 3.3.4 of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-fetch">HTTP fetch</a>, and
  step 12 of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-network-fetch">HTTP-network fetch</a>), Fetch should also execute the algorithm defined in <a href="#set-response-csp-list">§4.1.1 Populate response’s CSP list from its XSS protection policy.</a>.</p>
   </ol>
   <p class="issue" id="issue-d16995e8"><a class="self-link" href="#issue-d16995e8"></a> Upstream this once we decide it’s sane.</p>
   <h4 class="heading settled algorithm" data-algorithm="Populate response’s CSP list from its XSS protection policy." data-level="4.1.1" id="set-response-csp-list"><span class="secno">4.1.1. </span><span class="content"> Populate <var>response</var>’s CSP list from its XSS protection policy. </span><a class="self-link" href="#set-response-csp-list"></a></h4>
   <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>), this algorithm modifies its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-csp-list">CSP list</a> to
enforce the <a data-link-type="dfn" href="#xss-protection-policy" id="ref-for-xss-protection-policy-4">XSS protection policy</a> it specifies.</p>
   <ol>
    <li data-md="">
     <p>For each <var>policy</var> in the result of executing <a href="#policy-for-response">§2.2.1 Obtain a set of XSS protection policies for response.</a> on <var>response</var>:</p>
     <ol>
      <li data-md="">
       <p>If <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-nonce" id="ref-for-xss-protection-policy-nonce-2">nonce</a> is an empty string and <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-hash-set" id="ref-for-xss-protection-policy-hash-set-2">hash set</a> is empty, then skip the remaining
  substeps and move to the next <var>policy</var>.</p>
      <li data-md="">
       <p class="assertion">Assert: <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-nonce" id="ref-for-xss-protection-policy-nonce-3">nonce</a> is either an empty string or
  matches the <a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-base64-value">base64-value</a> grammar specified in <a data-link-type="biblio" href="#biblio-csp">[CSP]</a>. Likewise, <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-hash-set" id="ref-for-xss-protection-policy-hash-set-3">hash set</a> is either empty or all its values match the
  grammar "<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-algorithm">hash-algorithm</a>-<a data-link-type="grammar" href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source">hash-source</a>". Further, <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-reporting-group" id="ref-for-xss-protection-policy-reporting-group-2">reporting group</a> is a string that matches the <code>token</code> grammar defined in <a data-link-type="biblio" href="#biblio-rfc7230">[RFC7230]</a>.</p>
      <li data-md="">
       <p>Let <var>csp</var> be a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy">Content Security Policy</a> with an empty <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>, and a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-disposition">disposition</a> of "<code>enforce</code>".</p>
      <li data-md="">
       <p>Let <var>script-src</var> be the string "<code>'strict-dynamic'</code>".</p>
      <li data-md="">
       <p>If <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-nonce" id="ref-for-xss-protection-policy-nonce-4">nonce</a> is not an empty string, append to <var>script-src</var> the result of replacing "<code>%s</code>" in the string "<code>'nonce-%s'</code> " with <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-nonce" id="ref-for-xss-protection-policy-nonce-5">nonce</a>.</p>
      <li data-md="">
       <p>For each <var>digest</var> in <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-hash-set" id="ref-for-xss-protection-policy-hash-set-4">hash set</a>:</p>
       <ol>
        <li data-md="">
         <p>Append to <var>script-src</var> the result of replacing "<code>%s</code>" in the string "<code>'%s'</code> " with <var>digest</var>.</p>
       </ol>
      <li data-md="">
       <p>Add a new <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> to <var>csp</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>script-src</code>", and whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a> is <var>script-src</var>.</p>
      <li data-md="">
       <p>If <var>policy</var> has a <a data-link-type="dfn" href="#xss-protection-policy-reporting-group" id="ref-for-xss-protection-policy-reporting-group-3">reporting group</a> (<var>group</var>) which is not
  an empty string, then add a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directives">directive</a> to <var>csp</var> whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-name">name</a> is "<code>report-to</code>", and whose <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#directive-value">value</a> is <var>group</var>.</p>
      <li data-md="">
       <p>Append <var>policy</var> to <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-csp-list">CSP list</a>.</p>
     </ol>
   </ol>
   <h3 class="heading settled" data-level="4.2" id="monkey-patching-html"><span class="secno">4.2. </span><span class="content">Integration with HTML</span><a class="self-link" href="#monkey-patching-html"></a></h3>
   <ol>
    <li data-md="">
     <p>Each <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> has a <dfn class="dfn-paneled" data-dfn-for="Document" data-dfn-type="dfn" data-noexport="" id="document-reflected-xss-policy">reflected XSS policy</dfn>, which is one of <code>null</code>, "<code>ignore</code>", "<code>filter</code>", or "<code>block</code>". The value is <code>null</code> unless otherwise specified.</p>
    <li data-md="">
     <p>When executing <a href="https://w3c.github.io/webappsec-csp/#initialize-document-csp">Content Security Policy Level 3 §initialize-document-csp</a> (currently step 8 of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#initialise-the-document-object">initializing a new <code>Document</code> object</a> algorithm), HTML should also execute the algorithm defined in <a href="#initialize-document-xss">§4.2.1 Initialize a Document's reflected XSS policy.</a>.</p>
   </ol>
   <p class="issue" id="issue-d16995e80"><a class="self-link" href="#issue-d16995e80"></a> Upstream this once we decide it’s sane.</p>
   <h4 class="heading settled algorithm" data-algorithm="Initialize a Document&apos;s reflected XSS policy." data-level="4.2.1" id="initialize-document-xss"><span class="secno">4.2.1. </span><span class="content"> Initialize a <code>Document</code>'s reflected XSS policy. </span><a class="self-link" href="#initialize-document-xss"></a></h4>
   <p>Given a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">Document</a></code> (<var>document</var>), and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>), this algorithm sets <var>document</var>’s <a data-link-type="dfn" href="#document-reflected-xss-policy" id="ref-for-document-reflected-xss-policy-1">reflected XSS policy</a> based on <var>response</var>’s <a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-13"><code>XSS-Protection</code></a> and <code>X-XSS-Protection</code> headers.</p>
   <ol>
    <li data-md="">
     <p>Let <var>list</var> be an empty sequence.</p>
    <li data-md="">
     <p>Append the result of executing <a href="#parse-x-xss-protection">§4.2.2 Parse response’s X-XSS-Protection header value.</a> on <var>response</var> to <var>list</var>.</p>
    <li data-md="">
     <p>For each <var>policy</var> in the result of executing <a href="#policy-for-response">§2.2.1 Obtain a set of XSS protection policies for response.</a> on <var>response</var>,
  append <var>policy</var>’s <a data-link-type="dfn" href="#xss-protection-policy-reflection-policy" id="ref-for-xss-protection-policy-reflection-policy-2">reflection policy</a> to <var>list</var>.</p>
    <li data-md="">
     <p>Let <var>result</var> be <code>null</code>.</p>
    <li data-md="">
     <p>For each <var>item</var> in <var>list</var>:</p>
     <ol>
      <li data-md="">
       <p>If <var>item</var> is "<code>block</code>", set <var>result</var> to "<code>block</code>".</p>
      <li data-md="">
       <p>If <var>item</var> is "<code>filter</code>", and <var>result</var> is not "<code>block</code>", set <var>result</var> to "<code>filter</code>".</p>
      <li data-md="">
       <p>If <var>item</var> is "<code>ignore</code>", and <var>result</var> is not "<code>block</code>" or "<code>filter</code>", set <var>result</var> to
  "<code>ignore</code>".</p>
     </ol>
    <li data-md="">
     <p>Set <var>document</var>’s <a data-link-type="dfn" href="#document-reflected-xss-policy" id="ref-for-document-reflected-xss-policy-2">reflected XSS policy</a> to <var>result</var>.</p>
   </ol>
   <h4 class="heading settled algorithm" data-algorithm="Parse response’s X-XSS-Protection header value." data-level="4.2.2" id="parse-x-xss-protection"><span class="secno">4.2.2. </span><span class="content"> Parse <var>response</var>’s <code>X-XSS-Protection</code> header value. </span><a class="self-link" href="#parse-x-xss-protection"></a></h4>
   <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>), this algorithm returns <code>null</code>, "<code>ignore</code>", "<code>filter</code>", or
"<code>block</code>" based on the value (or absence) of its <code>X-XSS-Protection</code> header:</p>
   <ol>
    <li data-md="">
     <p>Let <var>value</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-parse">parsing</a> "<code>X-XSS-Protection</code>" in <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>.</p>
    <li data-md="">
     <p>If <var>value</var> is <code>null</code>, return <code>null</code>.</p>
    <li data-md="">
     <p>Let <var>list</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#strictly-split-a-string">strictly splitting</a> <var>value</var> on
  U+003B SEMICOLON ("<code>;</code>").</p>
    <li data-md="">
     <p>Let <var>result</var> be "<code>filter</code>".</p>
    <li data-md="">
     <p>Let <var>processedFirstItem</var> be <code>false</code>.</p>
    <li data-md="">
     <p>While <var>list</var> is not empty:</p>
     <ol>
      <li data-md="">
       <p>Let <var>item</var> be the result of popping the first item off of <var>list</var>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#strip-leading-and-trailing-whitespace">Strip leading and trailing whitespace</a> from <var>item</var>.</p>
      <li data-md="">
       <p>If <var>processedFirstItem</var> is <code>false</code>:</p>
       <ol>
        <li data-md="">
         <p>If the first character of <var>value</var> is "<code>0</code>", return "<code>ignore</code>".</p>
        <li data-md="">
         <p>If the first character of <var>value</var> is not "<code>1</code>", set <var>result</var> to "<code>filter</code>".</p>
        <li data-md="">
         <p>Set <var>processedFirstItem</var> to <code>true</code>.</p>
       </ol>
       <p>Otherwise:</p>
       <ol>
        <li data-md="">
         <p>If <var>value</var> is "<code>mode=block</code>", set <var>result</var> to "<code>block</code>".</p>
       </ol>
     </ol>
    <li data-md="">
     <p>Return <var>result</var>.</p>
   </ol>
   <p class="issue" id="issue-1a3df3b0"><a class="self-link" href="#issue-1a3df3b0"></a> Work in progress. This isn’t specified anywhere, so I’m eyeballing/simplifying Blink’s
implementation. It might or might not match Edge.</p>
   <h2 class="heading settled" data-level="5" id="implementation"><span class="secno">5. </span><span class="content">Implementation Considerations</span><a class="self-link" href="#implementation"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="error-messages"><span class="secno">5.1. </span><span class="content">Error Messages</span><a class="self-link" href="#error-messages"></a></h3>
   <p>The <a data-link-type="http-header" href="#http-headerdef-xss-protection" id="ref-for-http-headerdef-xss-protection-14"><code>XSS-Protection</code></a> mechanism is defined almost entirely in terms of <a data-link-type="biblio" href="#biblio-csp">[CSP]</a>.
This is intentional, as it means that user agents can easily reuse all the existing machinery
they’ve built up for that purpose. It might be confusing for developers, however, especially if,
in the distant future, CSP becomes an esoteric thing that no one uses on its own. Error messages,
in particular, might be confusing if they contain the synthesized CSP headers rather than the
headers the developer actually sent.</p>
   <p>That is, violation report console messages might look something like "Refused to execute inline
event handler because it violates the following Content Security Policy directive: '<code>script-src
'strict-dynamic' 'nonce-abcdefg'</code> ...". That is <em>technically</em> accurate (the best kind of
accurate), but not particularly helpful.</p>
   <p>User agents SHOULD ensure that the source of the policy is clear when triggering violations.</p>
   <p class="issue" id="issue-fbed4d71"><a class="self-link" href="#issue-fbed4d71"></a> Perhaps we should even extend the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-csp/#securitypolicyviolationevent">SecurityPolicyViolationEvent</a></code> and corresponding
violation report?</p>
   <h2 class="heading settled" data-level="6" id="acks"><span class="secno">6. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acks"></a></h2>
   <p>This proposal arose from a conversation in the WebAppSec meetings at TPAC 2016. Thanks to Artur
Janc for being a good sport about the original name (the lovingly backronymed "Anti-XSS
Response-Time Uniqueness Requirement"), to Richard Barnes for being appropriately skeptical at the
value provided, and to Sebastian Lekies and Krzysztof Kotowicz for being CSP gadflies in the most
honorably Socratic tradition.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-ae2b6bc0"><a class="self-link" href="#example-ae2b6bc0"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-reflectedxsspolicy-block">"block"</a><span>, in §3</span>
   <li><a href="#dom-reflectedxsspolicy-block">block</a><span>, in §3</span>
   <li><a href="#dom-reflectedxsspolicy-filter">filter</a><span>, in §3</span>
   <li><a href="#dom-reflectedxsspolicy-filter">"filter"</a><span>, in §3</span>
   <li>
    hash
    <ul>
     <li><a href="#dom-xssprotectionpolicy-hash">dict-member for XSSProtectionPolicy</a><span>, in §3</span>
     <li><a href="#xssprotectionpolicy-hash">dfn for XSSProtectionPolicy</a><span>, in §3.1</span>
    </ul>
   <li><a href="#xss-protection-policy-hash-set">hash set</a><span>, in §2.1</span>
   <li><a href="#dom-reflectedxsspolicy-ignore">"ignore"</a><span>, in §3</span>
   <li><a href="#dom-reflectedxsspolicy-ignore">ignore</a><span>, in §3</span>
   <li>
    nonce
    <ul>
     <li><a href="#xss-protection-policy-nonce">dfn for XSS protection policy</a><span>, in §2.1</span>
     <li><a href="#dom-xssprotectionpolicy-nonce">dict-member for XSSProtectionPolicy</a><span>, in §3</span>
     <li><a href="#xssprotectionpolicy-nonce">dfn for XSSProtectionPolicy</a><span>, in §3.2</span>
    </ul>
   <li><a href="#document-reflected-xss-policy">reflected XSS policy</a><span>, in §4.2</span>
   <li><a href="#enumdef-reflectedxsspolicy">ReflectedXSSPolicy</a><span>, in §3</span>
   <li>
    reflection
    <ul>
     <li><a href="#dom-xssprotectionpolicy-reflection">dict-member for XSSProtectionPolicy</a><span>, in §3</span>
     <li><a href="#xssprotectionpolicy-reflection">dfn for XSSProtectionPolicy</a><span>, in §3.3</span>
    </ul>
   <li><a href="#xss-protection-policy-reflection-policy">reflection policy</a><span>, in §2.1</span>
   <li>
    report
    <ul>
     <li><a href="#dom-xssprotectionpolicy-report">dict-member for XSSProtectionPolicy</a><span>, in §3</span>
     <li><a href="#xssprotectionpolicy-report">dfn for XSSProtectionPolicy</a><span>, in §3.4</span>
    </ul>
   <li><a href="#xss-protection-policy-reporting-group">reporting group</a><span>, in §2.1</span>
   <li><a href="#serialized-xss-protection-policy">serialized XSS protection policy</a><span>, in §3</span>
   <li><a href="#http-headerdef-xss-protection">XSS-Protection</a><span>, in §3</span>
   <li><a href="#xss-protection-policy">XSS protection policy</a><span>, in §2.1</span>
   <li><a href="#dictdef-xssprotectionpolicy">XSSProtectionPolicy</a><span>, in §3</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSP]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-csp/#securitypolicyviolationevent">SecurityPolicyViolationEvent</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-base64-value">base64-value</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#header-content-security-policy">content-security-policy</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#policy-directive-set">directive set</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#directives">directives</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#policy-disposition">disposition</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-hash-algorithm">hash-algorithm</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#grammardef-hash-source">hash-source</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#directive-name">name</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#policy">policy</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#directive-value">value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WHATWG-DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#document">Document</a>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-csp-list">csp list</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>
     <li><a href="https://fetch.spec.whatwg.org/#http-fetch">http fetch</a>
     <li><a href="https://fetch.spec.whatwg.org/#http-network-fetch">http-network fetch</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-parse">parse a header value</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response">response</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#window">Window</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">WorkerGlobalScope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#initialise-the-document-object">initializing a new document object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/scripting.html#attr-script-nonce">nonce</a>
     <li><a href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#strictly-split-a-string">strictly split a string</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#strip-leading-and-trailing-whitespace">strip leading and trailing whitespace</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTTP-JFV]</a> defines the following terms:
    <ul>
     <li><a href="http://httpwg.org/http-extensions/jfv.html#rfc.section.2">json-field-value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[REPORTING]</a> defines the following terms:
    <ul>
     <li><a href="https://wicg.github.io/reporting/#report-to">report-to</a>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC7230]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc7230#section-3.2.6">token</a>
    </ul>
   <li>
    <a data-link-type="biblio">[SRI]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-subresource-integrity/#dom-htmlscriptelement-integrity">integrity</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL-1]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp">[CSP]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-csp/">Content Security Policy Level 3</a>. 13 September 2016. WD. URL: <a href="https://w3c.github.io/webappsec-csp/">https://w3c.github.io/webappsec-csp/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Ian Hickson. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-http-jfv">[HTTP-JFV]
   <dd>Julian Reschke. <a href="http://httpwg.org/http-extensions/jfv.html">A JSON Encoding for HTTP Header Field Values</a>. URL: <a href="http://httpwg.org/http-extensions/jfv.html">http://httpwg.org/http-extensions/jfv.html</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
   <dt id="biblio-rfc7230">[RFC7230]
   <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7230">https://tools.ietf.org/html/rfc7230</a>
   <dt id="biblio-webidl-1">[WebIDL-1]
   <dd>Cameron McCormack; Boris Zbarsky. <a href="https://heycam.github.io/webidl/">WebIDL Level 1</a>. 15 September 2016. PR. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-whatwg-dom">[WHATWG-DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-csp-is-dead">[CSP-IS-DEAD]
   <dd>Lukas Weichselbaum; et al. <a href="https://research.google.com/pubs/pub45542.html">CSP Is Dead, Long Live CSP! On the Insecurity of Whitelists and the Future of Content Security Policy</a>. URL: <a href="https://research.google.com/pubs/pub45542.html">https://research.google.com/pubs/pub45542.html</a>
   <dt id="biblio-reporting">[REPORTING]
   <dd>Ilya Grigorik; Mike West. <a href="https://wicg.github.io/reporting/">Reporting API 1</a>. URL: <a href="https://wicg.github.io/reporting/">https://wicg.github.io/reporting/</a>
   <dt id="biblio-sha2">[SHA2]
   <dd><a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">FIPS PUB 180-4, Secure Hash Standard</a>. URL: <a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</a>
   <dt id="biblio-sri">[SRI]
   <dd>Devdatta Akhawe; et al. <a href="https://w3c.github.io/webappsec-subresource-integrity/">Subresource Integrity</a>. 23 June 2016. REC. URL: <a href="https://w3c.github.io/webappsec-subresource-integrity/">https://w3c.github.io/webappsec-subresource-integrity/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl def"><span class="kt">enum</span> <a class="nv" href="#enumdef-reflectedxsspolicy">ReflectedXSSPolicy</a> {
  <a class="s" href="#dom-reflectedxsspolicy-ignore">"ignore"</a>,
  <a class="s" href="#dom-reflectedxsspolicy-filter">"filter"</a>,
  <a class="s" href="#dom-reflectedxsspolicy-block">"block"</a>
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-xssprotectionpolicy">XSSProtectionPolicy</a> {
  <span class="kt">sequence</span>&lt;<span class="kt">DOMString</span>> <a class="nv" data-type="sequence<DOMString> " href="#dom-xssprotectionpolicy-hash">hash</a>;
  <span class="kt">DOMString</span> <a class="nv" data-type="DOMString " href="#dom-xssprotectionpolicy-nonce">nonce</a>;
  <a class="n" data-link-type="idl-name" href="#enumdef-reflectedxsspolicy">ReflectedXSSPolicy</a> <a class="nv" data-default="&quot;block&quot;" data-type="ReflectedXSSPolicy " href="#dom-xssprotectionpolicy-reflection">reflection</a> = "block";
  <span class="kt">DOMString</span> <a class="nv" data-default="&quot;default&quot;" data-type="DOMString " href="#dom-xssprotectionpolicy-report">report</a> = "default";
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Upstream this once we decide it’s sane.<a href="#issue-d16995e8"> ↵ </a></div>
   <div class="issue"> Upstream this once we decide it’s sane.<a href="#issue-d16995e80"> ↵ </a></div>
   <div class="issue"> Work in progress. This isn’t specified anywhere, so I’m eyeballing/simplifying Blink’s
implementation. It might or might not match Edge.<a href="#issue-1a3df3b0"> ↵ </a></div>
   <div class="issue"> Perhaps we should even extend the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-csp/#securitypolicyviolationevent">SecurityPolicyViolationEvent</a></code> and corresponding
violation report?<a href="#issue-fbed4d71"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="xss-protection-policy">
   <b><a href="#xss-protection-policy">#xss-protection-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-xss-protection-policy-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a> <a href="#ref-for-xss-protection-policy-2">(2)</a>
    <li><a href="#ref-for-xss-protection-policy-3">4. Integrations</a>
    <li><a href="#ref-for-xss-protection-policy-4">4.1.1. 
  Populate response’s CSP list from its XSS protection policy. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="xss-protection-policy-nonce">
   <b><a href="#xss-protection-policy-nonce">#xss-protection-policy-nonce</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-xss-protection-policy-nonce-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-xss-protection-policy-nonce-2">4.1.1. 
  Populate response’s CSP list from its XSS protection policy. </a> <a href="#ref-for-xss-protection-policy-nonce-3">(2)</a> <a href="#ref-for-xss-protection-policy-nonce-4">(3)</a> <a href="#ref-for-xss-protection-policy-nonce-5">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="xss-protection-policy-hash-set">
   <b><a href="#xss-protection-policy-hash-set">#xss-protection-policy-hash-set</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-xss-protection-policy-hash-set-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-xss-protection-policy-hash-set-2">4.1.1. 
  Populate response’s CSP list from its XSS protection policy. </a> <a href="#ref-for-xss-protection-policy-hash-set-3">(2)</a> <a href="#ref-for-xss-protection-policy-hash-set-4">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="xss-protection-policy-reporting-group">
   <b><a href="#xss-protection-policy-reporting-group">#xss-protection-policy-reporting-group</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-xss-protection-policy-reporting-group-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-xss-protection-policy-reporting-group-2">4.1.1. 
  Populate response’s CSP list from its XSS protection policy. </a> <a href="#ref-for-xss-protection-policy-reporting-group-3">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="xss-protection-policy-reflection-policy">
   <b><a href="#xss-protection-policy-reflection-policy">#xss-protection-policy-reflection-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-xss-protection-policy-reflection-policy-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-xss-protection-policy-reflection-policy-2">4.2.1. 
  Initialize a Document's reflected XSS policy. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="http-headerdef-xss-protection">
   <b><a href="#http-headerdef-xss-protection">#http-headerdef-xss-protection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-headerdef-xss-protection-1">1. Introduction</a> <a href="#ref-for-http-headerdef-xss-protection-2">(2)</a>
    <li><a href="#ref-for-http-headerdef-xss-protection-3">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-http-headerdef-xss-protection-4">3. The XSS-Protection HTTP Response Header</a>
    <li><a href="#ref-for-http-headerdef-xss-protection-5">3.1. The hash member</a> <a href="#ref-for-http-headerdef-xss-protection-6">(2)</a>
    <li><a href="#ref-for-http-headerdef-xss-protection-7">3.2. The nonce member</a> <a href="#ref-for-http-headerdef-xss-protection-8">(2)</a>
    <li><a href="#ref-for-http-headerdef-xss-protection-9">3.3. The reflection member</a> <a href="#ref-for-http-headerdef-xss-protection-10">(2)</a>
    <li><a href="#ref-for-http-headerdef-xss-protection-11">3.4. The report member</a>
    <li><a href="#ref-for-http-headerdef-xss-protection-12">4. Integrations</a>
    <li><a href="#ref-for-http-headerdef-xss-protection-13">4.2.1. 
  Initialize a Document's reflected XSS policy. </a>
    <li><a href="#ref-for-http-headerdef-xss-protection-14">5.1. Error Messages</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-reflectedxsspolicy">
   <b><a href="#enumdef-reflectedxsspolicy">#enumdef-reflectedxsspolicy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-reflectedxsspolicy-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-enumdef-reflectedxsspolicy-2">3. The XSS-Protection HTTP Response Header</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-reflectedxsspolicy-ignore">
   <b><a href="#dom-reflectedxsspolicy-ignore">#dom-reflectedxsspolicy-ignore</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-reflectedxsspolicy-ignore-1">3.3. The reflection member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-reflectedxsspolicy-filter">
   <b><a href="#dom-reflectedxsspolicy-filter">#dom-reflectedxsspolicy-filter</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-reflectedxsspolicy-filter-1">3.3. The reflection member</a> <a href="#ref-for-dom-reflectedxsspolicy-filter-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-reflectedxsspolicy-block">
   <b><a href="#dom-reflectedxsspolicy-block">#dom-reflectedxsspolicy-block</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-reflectedxsspolicy-block-1">3.3. The reflection member</a> <a href="#ref-for-dom-reflectedxsspolicy-block-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-xssprotectionpolicy-hash">
   <b><a href="#dom-xssprotectionpolicy-hash">#dom-xssprotectionpolicy-hash</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-xssprotectionpolicy-hash-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-xssprotectionpolicy-nonce">
   <b><a href="#dom-xssprotectionpolicy-nonce">#dom-xssprotectionpolicy-nonce</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-xssprotectionpolicy-nonce-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-dom-xssprotectionpolicy-nonce-2">3.4. The report member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-xssprotectionpolicy-reflection">
   <b><a href="#dom-xssprotectionpolicy-reflection">#dom-xssprotectionpolicy-reflection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-xssprotectionpolicy-reflection-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-dom-xssprotectionpolicy-reflection-2">3.3. The reflection member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-xssprotectionpolicy-report">
   <b><a href="#dom-xssprotectionpolicy-report">#dom-xssprotectionpolicy-report</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-xssprotectionpolicy-report-1">2.2.1. 
  Obtain a set of XSS protection policies for response. </a>
    <li><a href="#ref-for-dom-xssprotectionpolicy-report-2">3.4. The report member</a> <a href="#ref-for-dom-xssprotectionpolicy-report-3">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="xssprotectionpolicy-hash">
   <b><a href="#xssprotectionpolicy-hash">#xssprotectionpolicy-hash</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-xssprotectionpolicy-hash-1">3.1. The hash member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="xssprotectionpolicy-nonce">
   <b><a href="#xssprotectionpolicy-nonce">#xssprotectionpolicy-nonce</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-xssprotectionpolicy-nonce-1">1. Introduction</a>
    <li><a href="#ref-for-xssprotectionpolicy-nonce-2">3.2. The nonce member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-reflected-xss-policy">
   <b><a href="#document-reflected-xss-policy">#document-reflected-xss-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-reflected-xss-policy-1">4.2.1. 
  Initialize a Document's reflected XSS policy. </a> <a href="#ref-for-document-reflected-xss-policy-2">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>